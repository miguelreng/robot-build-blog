---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('posts');
posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const builders = [
	{ name: "Lorena Cardona", role: "Data Engineer", image: "https://github.com/lorenacardona.png" },
	{ name: "Jonathan Deiloff", role: "Data Engineer", image: "https://github.com/jonathandeiloff.png" },
	{ name: "David Cardozo", role: "Data Advisor", image: "https://github.com/davidcardozo.png" },
	{ name: "Kevin Torres", role: "Data Analyst", image: "https://github.com/kevintorres.png" }
];

const discussions = [
	{ topic: "On-device training latency", tag: "Performance" },
	{ topic: "Arlington sidewalk edge cases", tag: "Computer Vision" }
];

const aiDirectory = [
	{ tool: "PyTorch", category: "Framework" },
	{ tool: "OpenCV", category: "Vision" },
	{ tool: "ROS2", category: "Middleware" }
];
---

<Layout title="Home">
	<div class="space-y-12 md:space-y-16">
		{/* CEO Note - Compacted */}
		<section class="mb-12">
			<div class="text-[#403F3C]/60 text-[16px] md:text-[18px] leading-relaxed italic mb-6 font-medium max-w-lg text-balance">
				"Building general-purpose robots requires more than just code; it requires a commitment to raw, fast, and transparent iteration. This blog is our window into that process."
			</div>
			<div class="flex items-center gap-6">
                <div class="flex flex-col gap-0.5">
                    <div class="text-[15px] font-bold text-[#403F3C]">Felipe Ch√°vez</div>
                    <div class="text-[13px] text-[#403F3C]/40 font-bold">CEO at Robot.com</div>
                </div>
				{/* Signature Fake */}
				<div class="font-serif italic text-2xl text-[#403F3C]/30 select-none pb-1 border-b border-[#403F3C]/5 px-2">
					fchavez
				</div>
			</div>
		</section>

		<div class="space-y-12">
			{/* Memos Section */}
			<section>
				<h2 class="text-[13px] text-[#403F3C]/40 mb-3 font-medium border-b border-[#403F3C]/5 pb-3">Memos</h2>
				<ul class="space-y-4">
					{posts.map((post) => (
						<li class="w-full">
							<a 
                                href={`/posts/${post.slug}`} 
                                class="flex items-baseline justify-between w-full group preview-trigger"
                                data-preview={post.data.coverImage || "https://images.unsplash.com/photo-1485125639709-a60c3a500bf1?q=80&w=300"}
                            >
								<span class="text-[15px] font-medium text-[#403F3C] group-hover:underline decoration-1 underline-offset-4">{post.data.title}</span>
								<div class="flex-grow mx-4 border-b border-[#A2A19E]/15"></div>
								<span class="text-[13px] text-[#403F3C] font-medium whitespace-nowrap">{post.data.pubDate.toLocaleDateString('en-US', { month: '2-digit', day: '2-digit' })}</span>
							</a>
						</li>
					))}
				</ul>
			</section>

			{/* Builders Section */}
			<section>
				<h2 class="text-[13px] text-[#403F3C]/40 mb-3 font-medium border-b border-[#403F3C]/5 pb-3">Builders</h2>
				<ul class="space-y-4">
					{builders.map((builder) => (
						<li class="w-full">
							<a 
                                href="/builders" 
                                class="flex items-baseline justify-between w-full group preview-trigger"
                                data-preview={builder.image}
                            >
								<span class="text-[15px] font-medium text-[#403F3C] group-hover:underline decoration-1 underline-offset-4">{builder.name}</span>
								<div class="flex-grow mx-4 border-b border-[#A2A19E]/15"></div>
								<span class="text-[13px] text-[#403F3C] font-medium whitespace-nowrap">{builder.role}</span>
							</a>
						</li>
					))}
				</ul>
			</section>

			{/* Discussion Section */}
			<section>
				<h2 class="text-[13px] text-[#403F3C]/40 mb-3 font-medium border-b border-[#403F3C]/5 pb-3">Discussion</h2>
				<ul class="space-y-4">
					{discussions.map((item) => (
						<li class="w-full line-through opacity-30">
							<div class="flex items-baseline justify-between w-full group">
								<span class="text-[15px] font-medium text-[#403F3C]">{item.topic}</span>
								<div class="flex-grow mx-4 border-b border-[#A2A19E]/15"></div>
								<span class="text-[13px] text-[#403F3C] font-medium whitespace-nowrap">{item.tag}</span>
							</div>
						</li>
					))}
				</ul>
			</section>

			{/* Tools Section */}
			<section>
				<h2 class="text-[13px] text-[#403F3C]/40 mb-3 font-medium border-b border-[#403F3C]/5 pb-3">Tools</h2>
				<ul class="space-y-4">
					{aiDirectory.map((item) => (
						<li class="flex items-baseline justify-between w-full group cursor-pointer opacity-60 hover:opacity-100 transition-opacity">
							<span class="text-[15px] font-medium text-[#403F3C] group-hover:underline decoration-1 underline-offset-4">{item.tool}</span>
							<div class="flex-grow mx-4 border-b border-[#A2A19E]/15"></div>
							<span class="text-[13px] text-[#403F3C] font-medium whitespace-nowrap">{item.category}</span>
						</li>
					))}
				</ul>
			</section>
		</div>
	</div>

    {/* Floating Preview Mount */}
    <div id="hover-preview" class="fixed pointer-events-none z-[100] opacity-0 transition-opacity duration-200">
		<div class="w-[100px] h-[100px] overflow-hidden rounded-[20px] border border-[#403F3C]/10 shadow-2xl bg-white text-0">
			<img id="preview-img" src="" class="w-full h-full object-cover grayscale hover:grayscale-0 transition-all scale-105" />
		</div>
	</div>

    <script>
		const preview = document.getElementById('hover-preview');
		const previewImg = document.getElementById('preview-img') as HTMLImageElement;
		const triggers = document.querySelectorAll('.preview-trigger');

		triggers.forEach(el => {
			el.addEventListener('mouseenter', (e: any) => {
				const imgUrl = e.currentTarget.dataset.preview;
				if (imgUrl && preview && previewImg) {
					previewImg.src = imgUrl;
					preview.style.opacity = '1';
				}
			});
			el.addEventListener('mouseleave', () => { if (preview) preview.style.opacity = '0'; });
			el.addEventListener('mousemove', (e: any) => {
				if (preview) {
					preview.style.left = `${e.clientX + 20}px`;
					preview.style.top = `${e.clientY + 20}px`;
				}
			});
		});
	</script>
</Layout>
