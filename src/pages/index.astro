---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('posts');
posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const builders = [
	{ name: "Lorena Cardona", role: "Data Engineer", image: "https://i.pravatar.cc/150?u=lorena" },
	{ name: "Jonathan Deiloff", role: "Data Engineer", image: "https://i.pravatar.cc/150?u=jonathan" },
	{ name: "David Cardozo", role: "Data Advisor", image: "https://i.pravatar.cc/150?u=david" },
	{ name: "Kevin Torres", role: "Data Analyst", image: "https://i.pravatar.cc/150?u=kevin" }
];
---

<Layout title="Home">
	<div class="space-y-24">
		{/* Nota del CEO omitida para brevedad en este update */}
		
		<div class="space-y-16">
			{/* Memos Section */}
			<section>
				<h2 class="text-[12px] text-[#403F3C]/40 mb-6 font-medium border-b border-[#403F3C]/5 pb-4">Memos</h2>
				<ul class="space-y-4 pt-4">
					{posts.map((post) => (
						<li class="w-full">
							<a 
								href={`/posts/${post.slug}`} 
								class="flex items-baseline w-full text-[15px] font-medium text-[#403F3C] group memo-link"
								data-preview="https://images.unsplash.com/photo-1485827404703-89b55fcc595e?auto=format&fit=crop&q=80&w=300"
							>
								<span class="group-hover:underline decoration-1 underline-offset-4">{post.data.title}</span>
								<div class="flex-grow mx-2 border-b border-[#a2a19e]/30 shadow-[0_1px_0_0_rgba(162,161,158,0.28)]"></div>
								<span class="text-[13px] text-[#403F3C] font-medium whitespace-nowrap">{post.data.pubDate.toLocaleDateString('en-US', { month: '2-digit', day: '2-digit' })}</span>
							</a>
						</li>
					))}
				</ul>
			</section>

			{/* Builders Section */}
			<section>
				<h2 class="text-[12px] text-[#403F3C]/40 mb-6 font-medium border-b border-[#403F3C]/5 pb-4">Builders</h2>
				<ul class="space-y-4 pt-4">
					{builders.map((builder) => (
						<li class="w-full">
							<a 
								href="/builders" 
								class="flex items-baseline w-full text-[15px] font-medium text-[#403F3C] group builder-link"
								data-image={builder.image}
							>
								<span class="group-hover:underline decoration-1 underline-offset-4">{builder.name}</span>
								<div class="flex-grow mx-2 border-b border-[#a2a19e]/30 shadow-[0_1px_0_0_rgba(162,161,158,0.28)]"></div>
								<span class="text-[13px] text-[#403F3C] font-medium whitespace-nowrap">{builder.role}</span>
							</a>
						</li>
					))}
				</ul>
			</section>
		</div>
	</div>

	{/* Cursor Preview Element */}
	<div id="hover-preview" class="fixed pointer-events-none z-[100] opacity-0 transition-opacity duration-200">
		<div class="w-[100px] h-[100px] overflow-hidden rounded-sm border border-[#403F3C]/10 shadow-2xl bg-white">
			<img id="preview-img" src="" class="w-full h-full object-cover" />
		</div>
	</div>

	<script>
		const preview = document.getElementById('hover-preview');
		const previewImg = document.getElementById('preview-img') as HTMLImageElement;
		const links = document.querySelectorAll('.builder-link, .memo-link');

		links.forEach(link => {
			link.addEventListener('mouseenter', (e) => {
				const target = e.currentTarget as HTMLElement;
				const imgUrl = target.dataset.image || target.dataset.preview;
				if (imgUrl && preview && previewImg) {
					previewImg.src = imgUrl;
					preview.style.opacity = '1';
				}
			});

			link.addEventListener('mouseleave', () => {
				if (preview) preview.style.opacity = '0';
			});

			link.addEventListener('mousemove', (e: any) => {
				if (preview) {
					preview.style.left = `${e.clientX + 15}px`;
					preview.style.top = `${e.clientY + 15}px`;
				}
			});
		});
	</script>
</Layout>
