---
import Layout from '../layouts/Layout.astro';

// Password hardcoded para simplicidad absoluta
const BUILDER_PASSWORD = "robot-builders-2026";
---

<Layout title="Robot Memos Console">
	<div class="max-w-[580px] mx-auto">
		<h1 class="text-3xl font-medium tracking-tighter mb-4 text-[#403F3C]">Robot Memos Console</h1>
        <p class="text-[12px] text-[#403F3C]/40 mb-12 font-medium uppercase tracking-widest">Engineering Publishing Tool</p>
		
		<div id="auth-section" class="space-y-6">
			<p class="text-[14px] text-[#403F3C]/60 mb-4 font-medium">Enter builder password to access.</p>
			<input 
				type="password" 
				id="password" 
				placeholder="••••••••" 
				class="w-full bg-[#403F3C]/5 border-none rounded-sm px-4 py-3 text-[14px] text-[#403F3C] focus:ring-1 focus:ring-[#403F3C]/20 outline-none font-mono"
			/>
			<button 
				id="login-btn"
				class="w-full bg-[#403F3C] text-[#F8F6F3] text-[12px] font-bold uppercase tracking-widest py-3 rounded-sm hover:opacity-90 transition-opacity"
			>
				Access Console
			</button>
		</div>

		<div id="console-section" class="hidden space-y-16">
            <!-- API Configuration -->
            <section class="border-b border-[#403F3C]/5 pb-12">
				<h2 class="text-[10px] uppercase tracking-[0.2em] text-[#403F3C]/40 mb-6 font-bold">0. Engine Configuration</h2>
				<div class="space-y-4">
                    <label class="block text-[12px] font-medium text-[#403F3C]/60 italic mb-2">OpenRouter API Key (Stays in browser memory)</label>
                    <input 
                        type="password" 
                        id="api-key" 
                        placeholder="sk-or-v1-..." 
                        class="w-full bg-[#403F3C]/5 border-none rounded-sm px-4 py-3 text-[13px] text-[#403F3C] outline-none font-mono"
                    />
                </div>
			</section>

			<section class="border-b border-[#403F3C]/5 pb-12">
				<h2 class="text-[10px] uppercase tracking-[0.2em] text-[#403F3C]/40 mb-6 font-bold">1. Select Raw Memo</h2>
				<select id="memo-select" class="w-full bg-[#403F3C]/5 border-none rounded-sm px-4 py-3 text-[14px] text-[#403F3C] outline-none">
					<option value="">Choose a builder memo...</option>
                    <option value="2025Q4_W48_KevinTorres-DataAnalyst-Memo.md">Kevin Torres - Data Analyst</option>
                    <option value="2025Q3_W40_FredyAcuna-DataEngineer-Memo.md">Fredy Acuña - Data Engineer</option>
				</select>
			</section>

			<section class="border-b border-[#403F3C]/5 pb-12">
				<div class="flex justify-between items-baseline mb-6">
                    <h2 class="text-[10px] uppercase tracking-[0.2em] text-[#403F3C]/40 font-bold">2. Ai Transformation</h2>
                    <button id="generate-btn" class="text-[11px] font-bold border-b border-[#403F3C]/20 pb-0.5 hover:border-[#403F3C] transition-colors">
                        Generate Draft
                    </button>
                </div>
				<textarea 
					id="draft-area" 
					class="w-full h-[500px] bg-[#403F3C]/5 border-none rounded-sm px-6 py-6 text-[14px] text-[#403F3C]/80 font-medium leading-relaxed outline-none border border-transparent focus:border-[#403F3C]/10 transition-colors"
					placeholder="The AI will rewrite the technical memo here. You can then add images, sliders or charts manually."
				></textarea>
			</section>

			<section>
				<h2 class="text-[10px] uppercase tracking-[0.2em] text-[#403F3C]/40 mb-6 font-bold">3. Final Delivery</h2>
				<button id="publish-btn" class="w-full bg-[#403F3C] text-[#F8F6F3] text-[12px] font-bold uppercase tracking-widest py-4 rounded-sm hover:opacity-90 transition-opacity">
					Push to Main Repository
				</button>
			</section>
		</div>
	</div>

	<script>
		const loginBtn = document.getElementById('login-btn');
		const authSec = document.getElementById('auth-section');
		const consoleSec = document.getElementById('console-section');
		const passInput = document.getElementById('password') as HTMLInputElement;
        const apiKeyInput = document.getElementById('api-key') as HTMLInputElement;

        // Load key from storage if exists
        const savedKey = localStorage.getItem('robot_memos_key');
        if (savedKey && apiKeyInput) apiKeyInput.value = savedKey;

		loginBtn?.addEventListener('click', () => {
			if (passInput.value === "robot-builders-2026") {
				authSec?.classList.add('hidden');
				consoleSec?.classList.remove('hidden');
			} else {
				alert("Invalid builder password.");
			}
		});

        apiKeyInput?.addEventListener('change', () => {
            localStorage.setItem('robot_memos_key', apiKeyInput.value);
        });

        // El resto de la lógica de fetch y de llamar a OpenRouter irá aquí
	</script>
</Layout>
