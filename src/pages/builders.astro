---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { builders as buildersData } from '../data/builders';

const posts = await getCollection('posts');

const builders = buildersData.map(builder => {
	const avatarUrl = builder.github 
		? `https://github.com/${builder.github}.png`
		: `/images/placeholder.jpeg`;
	return {
		...builder,
		avatar: avatarUrl
	};
});

const groupedBuilders = builders.reduce((acc, builder) => {
	const dept = builder.department || 'Unassigned';
	if (!acc[dept]) acc[dept] = [];
	acc[dept].push(builder);
	return acc;
}, {} as Record<string, typeof builders>);
---

<Layout title="Builders">
	<h1 class="text-4xl font-semibold mb-16 text-brand-gray-90">Builders</h1>
	
	<div class="space-y-24">
		{Object.entries(groupedBuilders).sort(([a], [b]) => a.localeCompare(b)).map(([department, deptBuilders]) => (
			<section>
				<h2 class="text-sm font-semibold text-brand-gray-90/30 mb-10 border-b border-brand-gray-90/5 pb-4">
					{department}
				</h2>
				<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-16">
					{deptBuilders.map((builder) => (
						<div class="group cursor-pointer">
							<div class="aspect-square bg-brand-gray-90/5 rounded-sm mb-6 overflow-hidden grayscale group-hover:grayscale-0 transition-all">
								<img 
									src={builder.avatar} 
									alt={builder.name} 
									class="w-full h-full object-cover" 
									onerror="this.src='/images/placeholder.jpeg'"
								/>
							</div>
							<h3 class="text-sm font-semibold text-brand-gray-90 mb-1">{builder.name}</h3>
							<div class="text-[10px] font-semibold text-brand-gray-90/50">
								{builder.role}
							</div>
						</div>
					))}
				</div>
			</section>
		))}
	</div>
</Layout>
